# Система обработки ошибок

## Обзор

В приложении реализована комплексная система обработки ошибок, которая автоматически перенаправляет пользователя на страницу ошибки при любых проблемах:

1. **ErrorPage** - страница для отображения ошибок пользователю с иконками инструментов
2. **ErrorBoundary** - React компонент для отлова JavaScript ошибок в компонентах
3. **useErrorHandler** - хук для обработки API ошибок в компонентах
4. **Глобальные обработчики** - для необработанных ошибок JavaScript, сети и ресурсов
5. **API интерцепторы** - автоматическая обработка HTTP ошибок

## Компоненты

### ErrorPage
- Расположение: `src/pages/ErrorPage/ErrorPage.jsx`
- Отображает ошибки с иконками инструментов
- Кнопка "Перейти домой" для возврата на главную страницу
- Поддерживает кастомные коды ошибок и сообщения

### ErrorBoundary
- Расположение: `src/components/ErrorBoundary/ErrorBoundary.jsx`
- Отлавливает JavaScript ошибки в React компонентах
- Автоматически перенаправляет на ErrorPage при ошибках

### useErrorHandler
- Расположение: `src/hooks/useErrorHandler.js`
- Хук для обработки API ошибок
- Автоматически определяет тип ошибки и код
- Перенаправляет на ErrorPage с соответствующими параметрами

## Использование

### В компонентах с API вызовами:

```jsx
import { useErrorHandler } from '../../hooks/useErrorHandler';

const MyComponent = () => {
  const { handleError } = useErrorHandler();
  
  const fetchData = async () => {
    try {
      const response = await api.get('/data');
      // обработка успешного ответа
    } catch (error) {
      handleError(error, 'Ошибка при загрузке данных');
    }
  };
  
  return <div>...</div>;
};
```

### Обработка ошибок из хуков:

```jsx
import { useEffect } from 'react';
import { useErrorHandler } from '../../hooks/useErrorHandler';

const MyComponent = () => {
  const { handleError } = useErrorHandler();
  const { data, error } = useMyHook();
  
  useEffect(() => {
    if (error) {
      handleError(error, 'Ошибка при загрузке данных');
    }
  }, [error, handleError]);
  
  return <div>...</div>;
};
```

## Типы ошибок

### HTTP ошибки (автоматическая обработка):
- **400** - Неверный запрос
- **401** - Необходима авторизация (автоматический редирект на /login)
- **403** - Доступ запрещен
- **404** - Страница не найдена
- **5xx** - Ошибки сервера (автоматический редирект на /error)

### Сетевые ошибки (автоматическая обработка):
- Проблемы с подключением к серверу
- Отсутствие интернет-соединения
- Таймауты запросов

### JavaScript ошибки (автоматическая обработка):
- Ошибки в React компонентах
- Необработанные отклонения промисов
- Ошибки загрузки ресурсов (скрипты, стили)
- Любые необработанные исключения

### Ошибки компонентов (ручная обработка):
- Ошибки в хуках и API вызовах
- Ошибки валидации
- Пользовательские ошибки

## Настройка

### Добавление ErrorBoundary:
```jsx
import ErrorBoundary from './components/ErrorBoundary/ErrorBoundary';

<ErrorBoundary>
  <YourComponent />
</ErrorBoundary>
```

### Глобальные обработчики:
Автоматически настраиваются в `main.jsx` при запуске приложения.

## Логирование

Все ошибки логируются в консоль и могут быть расширены для отправки в сервис аналитики через функцию `logError` в `utils/errorHandler.js`.

## Тестирование

Для тестирования системы обработки ошибок доступен специальный компонент по маршруту `/error-test`, который позволяет вызвать различные типы ошибок:

- JavaScript ошибки
- Отклонения промисов
- API ошибки (404)
- Ошибки сервера (500)
- Сетевые ошибки

## Маршрутизация

Страница ошибки доступна по маршруту `/error` и автоматически получает параметры ошибки через:
- Состояние навигации (для ручных вызовов)
- URL параметры (для глобальных обработчиков)

## Автоматическая обработка

Система автоматически обрабатывает следующие ситуации:
- Любые необработанные JavaScript ошибки
- Ошибки сервера (5xx)
- Проблемы с сетью
- Отсутствие интернет-соединения
- Ошибки загрузки критических ресурсов

Все эти ошибки автоматически перенаправляют пользователя на страницу ошибки с соответствующим сообщением. 